<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
      integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
      crossorigin="anonymous"
    />

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"
    ></script>
    <title>UserList</title>
  </head>
  <body>
    <table id="userList" class="table table-striped table-bordered table-hover">
      <thead>
        <th>
          id
        </th>
        <th>
          name
        </th>
        <th>
          age
        </th>
        <th>options</th>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <button type="button" class="btn btn-success" id="adduser">Add User</button>
  </body>
  <script>
    let userList = [];
    // $(function() {
    //   $.ajax({
    //     url: "http://localhost:59999/api/user/alluser",
    //     type: "GET",
    //     success: function(data) {
    //       //console.log(data);
    //       userList = data;
    //       userList.forEach(element => {
    //         $("#tbody").append(
    //           $(
    //             `<tr><td>${element.id}</td><td>${element.name}</td><td>${element.age}</td></tr>`
    //           )
    //         );
    //       });
    //     }
    //   });
    // });
    $(function() {
      let userList = [];
      let curIndex = 0;
      $("#adduser").on("click", () => {
        window.location.replace(
          "file:///Users/junzhuoli/HTML/Servers/jquery_crud/client/addUser.html"
        );
        // window.location.href =
        //   "file:///Users/junzhuoli/HTML/Servers/jquery_crud/client/addUser.html";
      });
      $.get("http://localhost:59999/api/user/alluser", "id=9", function(data) {
        userList = data;
        userList.forEach(element => {
          $("#tbody").append(
            $(
              `<tr>
                <td>${element.id}</td>
                <td>${element.name}</td>
                <td>${element.age}</td>
                <td>
                    <input id="edit${element.id}" class="btn btn-info" type="button" value="edit" data-toggle="modal" data-target="#myModal">
                    <input id="delete${element.id}" class="btn btn-danger" type="button" value="delete">
                </td>
            </tr>`
            )
          );
          curIndex = userList.length;
          $("#tbody").delegate(`#delete${element.id}`, "click", function(e) {
            console.log("delete");
            $.ajax({
              url: `http://localhost:59999/api/user/deleteuser/${element.id}`,
              type: "DELETE",
              dataType: "json",
              success: function(data) {
                console.log(data);
                location.reload();
              }
            });
          });
        });
      });
    });
  </script>
</html>
